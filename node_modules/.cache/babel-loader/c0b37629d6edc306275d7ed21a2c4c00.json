{"ast":null,"code":"var _jsxFileName = \"/Users/gucenzhang/web-chess/online-chess-react-platform/src/pages/CoursesPage.js\";\nimport React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport CourseCard from '../components/Courses/CourseCard';\nimport CourseForm from '../components/Courses/CourseForm';\nimport Modal from 'react-modal';\nimport { useNavigate } from 'react-router-dom'; // 引入 useNavigate 钩子\n\nimport { useAuth } from '../contexts/AuthContext'; // 引入 useAuth 钩子\nimport '../components/Courses/CoursesPage.css';\naxios.defaults.baseURL = process.env.REACT_APP_API_BASE_URL;\nModal.setAppElement('#root'); // 设置模态对话框的根元素\n\nconst CoursesPage = () => {\n  const [courses, setCourses] = useState([]);\n  const [editingCourse, setEditingCourse] = useState(null);\n  const [showLoginModal, setShowLoginModal] = useState(false);\n  const {\n    user\n  } = useAuth(); // 使用 useAuth 钩子获取用户数据\n  const userRole = user === null || user === void 0 ? void 0 : user.role; // 直接访问用户角色\n  const navigate = useNavigate();\n  const userEnrolledCourses = (user === null || user === void 0 ? void 0 : user.purchasedCourses) || [];\n  console.log(\"Current user role:\", userRole); // 调试信息\n\n  useEffect(() => {\n    fetchCourses();\n    if (!user) {\n      setShowLoginModal(true);\n    }\n  }, [user]);\n  const fetchCourses = async () => {\n    try {\n      const response = await axios.get('/api/courses');\n      setCourses(response.data);\n    } catch (error) {\n      console.error('Error fetching courses:', error);\n    }\n  };\n  const handleAddCourse = async courseData => {\n    try {\n      const response = await axios.post('/api/courses', courseData);\n      setCourses(prevCourses => [...prevCourses, response.data]);\n    } catch (error) {\n      console.error('Error adding course:', error);\n    }\n  };\n  const handleUpdateCourse = async (id, courseData) => {\n    try {\n      const response = await axios.patch(`/api/courses/${id}`, courseData);\n      setCourses(prevCourses => prevCourses.map(course => course._id === id ? response.data : course));\n      setEditingCourse(null); // Reset editing course\n    } catch (error) {\n      console.error('Error updating course:', error);\n    }\n  };\n  const handleDeleteCourse = async id => {\n    try {\n      await axios.delete(`/api/courses/${id}`);\n      setCourses(prevCourses => prevCourses.filter(course => course._id !== id));\n    } catch (error) {\n      console.error('Error deleting course:', error);\n    }\n  };\n  const closeEditForm = () => {\n    setEditingCourse(null);\n  };\n  const navigateToLogin = () => {\n    navigate('/login'); // 修改为您的登录页面路由\n  };\n\n  const navigateToRegister = () => {\n    navigate('/register'); // 修改为您的注册页面路由\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"courses-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 7\n    }\n  }, \"Courses\"), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 7\n    }\n  }, \"Here is a list of available courses.\"), userRole === 'instructor' || userRole === 'admin' ? /*#__PURE__*/React.createElement(React.Fragment, null, !editingCourse && /*#__PURE__*/React.createElement(CourseForm, {\n    setCourses: setCourses,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 30\n    }\n  }), editingCourse && /*#__PURE__*/React.createElement(CourseForm, {\n    course: editingCourse,\n    setCourses: setCourses,\n    closeModal: closeEditForm,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 13\n    }\n  })) : null, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"course-list\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 7\n    }\n  }, courses.map(course => /*#__PURE__*/React.createElement(CourseCard, {\n    key: course._id,\n    course: course,\n    onEdit: userRole === 'instructor' || userRole === 'admin' ? () => setEditingCourse(course) : null,\n    onDelete: userRole === 'instructor' || userRole === 'admin' ? () => handleDeleteCourse(course._id) : null,\n    userRole: userRole,\n    isEnrolled: userEnrolledCourses.includes(course._id) // 检查用户是否已注册该课程\n    ,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(Modal, {\n    isOpen: showLoginModal,\n    onRequestClose: () => setShowLoginModal(false),\n    contentLabel: \"Login Reminder\",\n    className: \"modal\",\n    overlayClassName: \"overlay\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 9\n    }\n  }, \"Login Required\"), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 9\n    }\n  }, \"You need to be logged in to view enroll courses. Please login or register.\"), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: navigateToLogin,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 9\n    }\n  }, \"Login\"), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: navigateToRegister,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 9\n    }\n  }, \"Register\"))));\n};\nexport default CoursesPage;","map":{"version":3,"names":["React","useState","useEffect","axios","CourseCard","CourseForm","Modal","useNavigate","useAuth","defaults","baseURL","process","env","REACT_APP_API_BASE_URL","setAppElement","CoursesPage","courses","setCourses","editingCourse","setEditingCourse","showLoginModal","setShowLoginModal","user","userRole","role","navigate","userEnrolledCourses","purchasedCourses","console","log","fetchCourses","response","get","data","error","handleAddCourse","courseData","post","prevCourses","handleUpdateCourse","id","patch","map","course","_id","handleDeleteCourse","delete","filter","closeEditForm","navigateToLogin","navigateToRegister","createElement","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","Fragment","closeModal","key","onEdit","onDelete","isEnrolled","includes","isOpen","onRequestClose","contentLabel","overlayClassName","onClick"],"sources":["/Users/gucenzhang/web-chess/online-chess-react-platform/src/pages/CoursesPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport CourseCard from '../components/Courses/CourseCard';\nimport CourseForm from '../components/Courses/CourseForm';\nimport Modal from 'react-modal';\nimport { useNavigate } from 'react-router-dom'; // 引入 useNavigate 钩子\n\nimport { useAuth } from '../contexts/AuthContext'; // 引入 useAuth 钩子\nimport '../components/Courses/CoursesPage.css';\n\naxios.defaults.baseURL = process.env.REACT_APP_API_BASE_URL;\nModal.setAppElement('#root'); // 设置模态对话框的根元素\n\n\nconst CoursesPage = () => {\n  const [courses, setCourses] = useState([]);\n  const [editingCourse, setEditingCourse] = useState(null);\n  const [showLoginModal, setShowLoginModal] = useState(false);\n\n  const { user } = useAuth(); // 使用 useAuth 钩子获取用户数据\n  const userRole = user?.role; // 直接访问用户角色\n  const navigate = useNavigate();\n  const userEnrolledCourses = user?.purchasedCourses || [];\n\n  console.log(\"Current user role:\", userRole); // 调试信息\n\n  useEffect(() => {\n    fetchCourses();\n    if (!user) {\n      setShowLoginModal(true);\n    }\n  }, [user]);\n\n  const fetchCourses = async () => {\n    try {\n      const response = await axios.get('/api/courses');\n      setCourses(response.data);\n    } catch (error) {\n      console.error('Error fetching courses:', error);\n    }\n  };\n\n  const handleAddCourse = async (courseData) => {\n    try {\n      const response = await axios.post('/api/courses', courseData);\n      setCourses(prevCourses => [...prevCourses, response.data]);\n    } catch (error) {\n      console.error('Error adding course:', error);\n    }\n  };\n\n  const handleUpdateCourse = async (id, courseData) => {\n    try {\n      const response = await axios.patch(`/api/courses/${id}`, courseData);\n      setCourses(prevCourses =>\n        prevCourses.map(course => (course._id === id ? response.data : course))\n      );\n      setEditingCourse(null); // Reset editing course\n    } catch (error) {\n      console.error('Error updating course:', error);\n    }\n  };\n\n  const handleDeleteCourse = async (id) => {\n    try {\n      await axios.delete(`/api/courses/${id}`);\n      setCourses(prevCourses =>\n        prevCourses.filter(course => course._id !== id)\n      );\n    } catch (error) {\n      console.error('Error deleting course:', error);\n    }\n  };\n\n  const closeEditForm = () => {\n    setEditingCourse(null);\n  };\n\n  const navigateToLogin = () => {\n    navigate('/login'); // 修改为您的登录页面路由\n  };\n\n  const navigateToRegister = () => {\n    navigate('/register'); // 修改为您的注册页面路由\n  }\n\n  return (\n    <div className=\"courses-container\">\n      <h1>Courses</h1>\n      <p>Here is a list of available courses.</p>\n      {userRole === 'instructor' || userRole === 'admin' ? (\n        <>\n          {!editingCourse && <CourseForm setCourses={setCourses} />}\n          {editingCourse && (\n            <CourseForm\n              course={editingCourse}\n              setCourses={setCourses}\n              closeModal={closeEditForm}\n            />\n          )}\n        </>\n      ) : null}\n      <div className=\"course-list\">\n      {courses.map(course => (\n          <CourseCard\n            key={course._id}\n            course={course}\n            onEdit={userRole === 'instructor' || userRole === 'admin' ? () => setEditingCourse(course) : null}\n            onDelete={userRole === 'instructor' || userRole === 'admin' ? () => handleDeleteCourse(course._id) : null}\n            userRole={userRole}\n            isEnrolled={userEnrolledCourses.includes(course._id)} // 检查用户是否已注册该课程\n          />\n        ))}\n\n        <Modal\n        isOpen={showLoginModal}\n        onRequestClose={() => setShowLoginModal(false)}\n        contentLabel=\"Login Reminder\"\n        className=\"modal\"\n        overlayClassName=\"overlay\"\n      >\n        <h2>Login Required</h2>\n        <p>You need to be logged in to view enroll courses. Please login or register.</p>\n        <button onClick={navigateToLogin}>Login</button>\n        <button onClick={navigateToRegister}>Register</button>\n      </Modal>\n      </div>\n    </div>\n  );\n};\n\nexport default CoursesPage;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}